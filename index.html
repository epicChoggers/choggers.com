<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cal Raleigh Appreciation</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0c162f;
      color: #ffffff;
      margin: 0;
      padding: 0;
    }
    header {
      background: #00193d;
      padding: 20px 0;
      text-align: center;
    }
    h1 {
      margin: 0;
      color: #ff4c00;
    }
    nav {
      margin-top: 10px;
    }
    nav a {
      color: #ff4c00;
      text-decoration: none;
      margin: 0 10px;
    }
    section {
      padding: 40px 20px;
      max-width: 800px;
      margin: auto;
      text-align: center;
    }
    .stats div {
      font-size: 1.2em;
      margin: 8px 0;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      margin-bottom: 6px;
    }
    footer {
      background: #00193d;
      padding: 20px;
      text-align: center;
      color: #888;
    }
    a.external {
      color: #4ba3ff;
    }
    #hrChart {
      width: 100%;
      height: 400px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Cal Raleigh Appreciation</h1>
    <nav>
      <a href="#bio">Bio</a>
      <a href="#stats">Stats</a>
      <a href="#pace-chart">HR Pace</a>
      <a href="#facts">Fun Facts</a>
    </nav>
  </header>

  <section id="bio">
    <h2>About Cal</h2>
    <p>Cal Raleigh is the hard-hitting catcher for the Seattle Mariners, beloved by
      fans for clutch home runs and steady defense. Born November 26, 1996 in
      Cullowhee, North Carolina, he played college baseball at Florida State
      before being drafted by the Mariners in 2018. Raleigh made his MLB debut
      in 2021 and quickly earned the nickname <em>"Big Dumper"</em> from Mariners
      broadcaster Mike Blowers.</p>
  </section>

  <section id="stats">
    <h2>2024 Season Tracker</h2>
    <div id="stats-container" class="stats">
      <div>Loading...</div>
    </div>
  </section>

  <section id="pace-chart">
    <h2>HR Pace vs. Historic Seasons</h2>
    <canvas id="hrChart"></canvas>
  </section>

  <section id="facts">
    <h2>Fun Facts</h2>
    <ul>
      <li>Switch-hitting catcher with tremendous power from the left side.</li>
      <li>Hit a walk-off homer in 2022 that clinched Seattle's first postseason
          berth in over two decades.</li>
      <li>Loves fishing in the offseason.</li>
    </ul>
    <p>More info at
      <a class="external" href="https://www.mlb.com/player/cal-raleigh-663728"
         target="_blank" rel="noopener">MLB.com</a>.</p>
  </section>

  <footer>
    Made with ‚ù§ by Mariners fans.
  </footer>

  <script src="js/chart.min.js"></script>
  <script>
    async function loadStats() {
      try {
        const res = await fetch('https://statsapi.mlb.com/api/v1/people/663728/stats?stats=season&group=hitting');
        const data = await res.json();
        const stat = data.stats[0].splits[0].stat;
        const games = parseInt(stat.gamesPlayed, 10);
        const homers = parseInt(stat.homeRuns, 10);
        const avg = parseFloat(stat.avg).toFixed(3);
        const pace = ((homers / games) * 162).toFixed(1);
        document.getElementById('stats-container').innerHTML = `
          <div>Games Played: <strong>${games}</strong></div>
          <div>Home Runs: <strong>${homers}</strong></div>
          <div>Batting Avg: <strong>${avg}</strong></div>
          <div>Projected HRs (162g pace): <strong>${pace}</strong></div>
        `;
      } catch (err) {
        document.getElementById('stats-container').innerText = 'Stats unavailable.';
      }
    }

    async function loadHRLogs() {
      const res = await fetch('js/hr_data.json');
      return res.json();
    }

    function rollingPace(hrByGame) {
      const out = [];
      for (let i = 0; i < hrByGame.length; i++) {
        if (hrByGame[i] == null) {
          out.push(null);
          continue;
        }
        const start = Math.max(0, i - 2);
        const slice = hrByGame.slice(start, i + 1).filter(v => v != null);
        const avg = slice.reduce((a, b) => a + b, 0) / slice.length;
        out.push(avg * 162);
      }
      return out;
    }

    async function drawChart() {
      const players = [
        { key: 'bonds01', label: 'Bonds01', color: '#ff6384' },
        { key: 'judge22', label: 'Judge22', color: '#36a2eb' },
        { key: 'judge24', label: 'Judge24', color: '#ffcd56' },
        { key: 'cal24', label: 'Cal24', color: '#4bc0c0' }
      ];

      const data = await loadHRLogs();
      const logs = players.map(p => data[p.key]);
      const maxLen = Math.max(...logs.map(l => l.length));
      const labels = Array.from({ length: maxLen }, (_, i) => i + 1);

      const datasets = logs.map((log, i) => ({
        label: players[i].label,
        data: rollingPace(log),
        borderColor: players[i].color,
        tension: 0.3,
        borderWidth: 2,
        fill: false,
        pointRadius: 0
      }));

      datasets.push({
        label: '63 HRs',
        data: Array.from({ length: maxLen }, () => 63),
        borderColor: '#666',
        borderDash: [5, 5],
        borderWidth: 1,
        pointRadius: 0,
        fill: false
      });

      const ctx = document.getElementById('hrChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: { labels, datasets },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          spanGaps: true,
          layout: {
            padding: 20
          },
          scales: {
            x: {
              title: {
                display: true,
                text: '# of team games into the season'
              }
            },
            y: {
              title: {
                display: true,
                text: 'HR pace (3-game rolling average)'
              },
              beginAtZero: true
            }
          },
          plugins: {
            title: {
              display: true,
              text: 'Home Run pace throughout the season'
            }
          }
        }
      });
    }

    loadStats();
    drawChart();
  </script>
</body>
</html>
