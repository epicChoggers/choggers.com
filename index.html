<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Cal Raleigh HR Pace Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      background-color: #0d1117;
      color: #c9d1d9;
      font-family: 'Roboto Mono', monospace;
    }
    header {
      background-color: #161b22;
      padding: 20px;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
      border-bottom: 1px solid #30363d;
    }
    .content {
      padding: 20px;
      max-width: 1000px;
      margin: auto;
    }
    .stat-block {
      background-color: #161b22;
      border: 1px solid #30363d;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }
    canvas {
      width: 100% !important;
      max-height: 500px;
    }
  </style>
</head>
<body>
  <header>Cal Raleigh HR Game Log Comparison</header>
  <div class="content">
    <div class="stat-block">
      <h2>Home Run Progression by Game</h2>
      <canvas id="lineChart"></canvas>
    </div>
  </div>

<script>
  const players = [
    { label: "Barry Bonds 2001", id: 111188, season: 2001 },
    { label: "Aaron Judge 2022", id: 592450, season: 2022 },
    { label: "Aaron Judge 2024", id: 592450, season: 2024 },
    { label: "Cal Raleigh 2025", id: 663728, season: 2025 }
  ];

  async function fetchHRData() {
    const results = {};
    const summary = [];

    for (const { label, id, season } of players) {
      const url = `https://statsapi.mlb.com/api/v1/people/${id}/stats?stats=gameLog&season=${season}&group=hitting`;
      const res = await fetch(url);
      const json = await res.json();
      const games = json?.stats?.[0]?.splits || [];

      let totalHR = 0;
      const progression = [];

      for (const game of games.reverse()) {
        totalHR += Number(game.stat.homeRuns || 0);
        progression.push(totalHR);
      }

      results[label] = progression;
      summary.push({ label, season, totalHR, gamesPlayed: progression.length });
    }

    return { results, summary };
  }

  function renderStats(summary) {
    const block = document.createElement('div');
    block.style.padding = '1em';
    block.style.fontSize = '0.9em';

    summary.sort((a, b) => b.totalHR - a.totalHR);

block.innerHTML = `<h3>HR Summary</h3>` + summary.map(s => {
  const pace = (s.totalHR / s.gamesPlayed * 162).toFixed(1);
  const isCal = s.label === "Cal Raleigh 2025";
  return `<div style="margin-bottom: 0.5em; font-weight:${isCal ? 'bold' : 'normal'};">
    ${isCal ? 'ðŸŸ¢' : ''} <strong>${s.label}</strong> (${s.season}) â€“ 
    ${s.totalHR} HR in ${s.gamesPlayed} G (
    <span style="color:gray;">${pace} pace</span>)
  </div>`;
}).join('');


    document.querySelector('.content').appendChild(block);
  }

  async function fetchSeasonStats() {
    const data = [];
    for (const { label, id, season } of players) {
      const url = `https://statsapi.mlb.com/api/v1/people/${id}/stats?stats=season&group=hitting&season=${season}`;
      const res = await fetch(url);
      const json = await res.json();
      const stat = json?.stats?.[0]?.splits?.[0]?.stat;

      data.push({
        label,
        AVG: parseFloat(stat.avg),
        OBP: parseFloat(stat.obp),
        SLG: parseFloat(stat.slg),
        OPS: parseFloat(stat.ops),
        AB_HR: (parseInt(stat.atBats) / Math.max(1, parseInt(stat.homeRuns))).toFixed(3) // AB/HR
      });
    }
    return data;
  }

  async function plotTableStats() {
    const stats = await fetchSeasonStats();
    const labels = ['AVG', 'OBP', 'SLG', 'OPS', 'AB/HR'];

    // Find leader for each stat (max value)
    const leaders = {};
    labels.forEach(label => {
      let max = -Infinity;
      let idx = -1;
      stats.forEach((p, i) => {
        const val = parseFloat(p[label.replace('/', '_')]);
        if (val > max) {
          max = val;
          idx = i;
        }
      });
      leaders[label] = idx;
    });

    const wrapper = document.createElement('div');
    wrapper.className = 'stat-block';
    wrapper.innerHTML = `<h2>Season Rate Stats</h2>`;

    let table = `<table style="width:100%;border-collapse:collapse;text-align:center;">`;
    table += `<thead><tr><th style='color:#c9d1d9;'>Player</th>`;
    labels.forEach(l => {
      table += `<th style='color:#c9d1d9;'>${l}</th>`;
    });
    table += `</tr></thead><tbody>`;
    stats.forEach((p, i) => {
      table += `<tr>`;
      table += `<td style='color:#c9d1d9;${p.label.includes('Cal Raleigh') ? 'font-weight:bold;' : ''}'>${p.label}</td>`;
      labels.forEach((l, j) => {
        let val = p[l.replace('/', '_')];
        // Format as X.XXX
        val = (isNaN(val) ? val : Number(val).toFixed(3));
        const isLeader = leaders[l] === i;
        table += `<td style='color:#c9d1d9;${isLeader ? 'font-weight:bold;' : ''}'>${val}</td>`;
      });
      table += `</tr>`;
    });
    table += `</tbody></table>`;
    wrapper.innerHTML += table;
    document.querySelector('.content').appendChild(wrapper);
  }

  async function plotChart() {
    const { results, summary } = await fetchHRData();

    const datasets = Object.entries(results).map(([label, data], index) => {
      const isCal = label.includes('Cal Raleigh 2025');
      return {
        label,
        data,
        fill: false,
        borderColor: isCal ? '#00e676' : ['#1f6feb', '#c62828', '#ad1457'][index % 3],
        borderWidth: isCal ? 4 : 2,
        borderDash: isCal ? [] : [4, 4],
        tension: 0.25,
        pointRadius: 0
      };
    });

    new Chart(document.getElementById('lineChart'), {
      type: 'line',
      data: {
        labels: Array.from({ length: 162 }, (_, i) => i + 1),
        datasets
      },
      options: {
        responsive: true,
        plugins: {
          legend: { labels: { color: '#c9d1d9' } },
          title: {
            display: true,
            text: 'Home Run Pace Comparison',
            color: '#c9d1d9',
            font: { size: 20 }
          }
        },
        scales: {
          x: {
            title: { display: true, text: 'Game Number', color: '#c9d1d9' },
            ticks: { color: '#c9d1d9' }
          },
          y: {
            beginAtZero: true,
            title: { display: true, text: 'Home Runs', color: '#c9d1d9' },
            ticks: { color: '#c9d1d9' }
          }
        }
      }
    });

    renderStats(summary);
    await plotTableStats();
  }

  plotChart();
</script>


</body>
</html>
